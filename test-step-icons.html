<!DOCTYPE html>
<html>
<head>
    <title>Test Step Icons System</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .test-case { background: white; margin: 10px 0; padding: 15px; border-radius: 5px; border-left: 4px solid #666; }
        .pass { border-left-color: #2ECC71; background: #f0f8f0; }
        .fail { border-left-color: #E74C3C; background: #f8f0f0; }
        .pending { border-left-color: #F39C12; background: #f8f6f0; }
        code { background: #f0f0f0; padding: 2px 5px; border-radius: 3px; }
        h2 { color: #333; }
    </style>
</head>
<body>
    <h1>üß™ Test Suite: Step Icons System</h1>
    <div id="results"></div>

    <script>
        const results = [];
        
        function test(name, fn) {
            try {
                const result = fn();
                results.push({
                    name,
                    pass: result.pass,
                    message: result.message,
                    time: new Date().toLocaleTimeString()
                });
            } catch(e) {
                results.push({
                    name,
                    pass: false,
                    message: `Error: ${e.message}`,
                    time: new Date().toLocaleTimeString()
                });
            }
        }

        // Test 1: Check if updateStepIcons function exists
        test('Function updateStepIcons exists', () => {
            const exists = typeof updateStepIcons === 'function';
            return {
                pass: exists,
                message: exists ? '‚úÖ updateStepIcons is defined' : '‚ùå updateStepIcons not found'
            };
        });

        // Test 2: Check if getStepLockState function exists
        test('Function getStepLockState exists', () => {
            const exists = typeof getStepLockState === 'function';
            return {
                pass: exists,
                message: exists ? '‚úÖ getStepLockState is defined' : '‚ùå getStepLockState not found'
            };
        });

        // Test 3: Check if CHAPITRES data exists
        test('CHAPITRES data loaded', () => {
            const exists = typeof CHAPITRES !== 'undefined' && CHAPITRES.length > 0;
            return {
                pass: exists,
                message: exists ? `‚úÖ CHAPITRES loaded (${CHAPITRES.length} chapters)` : '‚ùå CHAPITRES not found'
            };
        });

        // Test 4: Check if App object exists
        test('App object exists', () => {
            const exists = typeof App === 'object' && App !== null;
            return {
                pass: exists,
                message: exists ? '‚úÖ App object exists' : '‚ùå App object not found'
            };
        });

        // Test 5: Check updateStepIcons method exists in App
        test('App.updateStepIcons method exists', () => {
            const exists = typeof App.updateStepIcons === 'function';
            return {
                pass: exists,
                message: exists ? '‚úÖ App.updateStepIcons is defined' : '‚ùå App.updateStepIcons not found'
            };
        });

        // Test 6: Check marquerEtapeComplete method exists
        test('App.marquerEtapeComplete method exists', () => {
            const exists = typeof App.marquerEtapeComplete === 'function';
            return {
                pass: exists,
                message: exists ? '‚úÖ App.marquerEtapeComplete is defined' : '‚ùå App.marquerEtapeComplete not found'
            };
        });

        // Test 7: Check completerChapitre method exists
        test('App.completerChapitre method exists', () => {
            const exists = typeof App.completerChapitre === 'function';
            return {
                pass: exists,
                message: exists ? '‚úÖ App.completerChapitre is defined' : '‚ùå App.completerChapitre not found'
            };
        });

        // Test 8: Check StorageManager exists
        test('StorageManager exists', () => {
            const exists = typeof StorageManager === 'object' && StorageManager !== null;
            return {
                pass: exists,
                message: exists ? '‚úÖ StorageManager exists' : '‚ùå StorageManager not found'
            };
        });

        // Test 9: Verify first chapter structure
        test('First chapter has etapes array', () => {
            const ch = CHAPITRES[0];
            const hasEtapes = ch && Array.isArray(ch.etapes) && ch.etapes.length > 0;
            const message = hasEtapes 
                ? `‚úÖ Chapter "${ch.titre}" has ${ch.etapes.length} etapes` 
                : '‚ùå Chapter structure invalid';
            return { pass: hasEtapes, message };
        });

        // Test 10: Check if objectives (etape[0]) exist
        test('Objectives (etapes[0]) structure correct', () => {
            const ch = CHAPITRES[0];
            const obj = ch?.etapes?.[0];
            const isObjective = obj?.titre?.toLowerCase().includes('objectif') || obj?.titre?.toLowerCase().includes('jalon');
            const message = isObjective 
                ? `‚úÖ First etape is objectives: "${obj.titre}"` 
                : `‚ùå First etape should be objectives, got: "${obj?.titre || 'undefined'}"`;
            return { pass: isObjective, message };
        });

        // Render results
        setTimeout(() => {
            const html = results.map(r => {
                const className = r.pass ? 'pass' : 'fail';
                const icon = r.pass ? '‚úÖ' : '‚ùå';
                return `
                    <div class="test-case ${className}">
                        <strong>${icon} ${r.name}</strong>
                        <p style="margin: 5px 0 0 0; color: #666;">${r.message}</p>
                    </div>
                `;
            }).join('');
            
            const passCount = results.filter(r => r.pass).length;
            const totalCount = results.length;
            
            document.getElementById('results').innerHTML = `
                <h3>Results: ${passCount}/${totalCount} tests passed</h3>
                ${html}
            `;
        }, 1000);
    </script>
</body>
</html>
